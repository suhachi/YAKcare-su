## 프로젝트 전반 정밀 진단 보고서

작성일: 2025-11-08  
담당: AI Assistant  

### 1. 요약
- 배포 환경(Vercel)에서 기본 로그인/회원가입, 카메라 권한, 개인정보 흐름은 동작하나, 핵심 스캔·데이터 연동 로직은 목업 단계.
- Supabase 인증/데이터 스키마는 구축되어 있으나 자동화 테스트 부족, 이메일 인증 링크 리다이렉트 등 추가 손질 요소 존재.
- UI/UX 측면에서 PWA 설치, 실사용자 플로우(복용자 vs 보호자) 세분화, 접근성 개선 필요.

### 2. 주요 기능 현황
| 구분 | 구현 상태 | 비고 |
| --- | --- | --- |
| 로그인/로그아웃 | ✅ | 이메일/비밀번호 기반. 이메일 인증 필수. |
| 회원가입 | ✅ | 복용자/보호자 역할 선택 후 `user_metadata.role` 저장. 이메일 인증 필요. |
| 홈 화면(복용자) | ✅ (목업) | Supabase 연동 일부. 실데이터 모델링 필요. |
| 복용 등록/QR 스캔 | ⚠️ | 카메라 권한/프리뷰는 구현, 스캔 결과는 랜덤 시뮬레이션. |
| 보호자 홈/피드 | ⚠️ (DEV 전용) | DEV 모드에서만 접근. 실제 데이터 연동 미완성. |
| 링크 공유/초대 | ⚠️ | UI는 존재, Supabase `links.service`는 목(mock) 기반. |
| 환경 설정 | ✅ (기본) | Supabase URL, Key `.env` 관리. Figma 설정은 플레이스홀더. |

### 3. Supabase 및 백엔드 점검
- **Auth**: Email Provider 활성화, 이메일 인증 필요. `Site URL` 기본값이 `localhost`였기에 수정 필요(현재 배포 주소로 설정 완료). 이메일 미인증 시 로그인 불가.
- **Database**: `medications`, `doses`, `care_links`, `health_records` 등 스키마 구성되어 있으나, 목 데이터 / Partial DAO 구현만 있음.
- **RLS**: SQL 스크립트는 포함되어 있으나 실제 배포 환경 적용 여부 확인 필요. `Auth` 로그/에러 모니터링 세팅 추천.
- **Edge Function**: Supabase Functions 디렉터리 존재 하나, 실제 배포/테스트는 미진행.

### 4. 프론트엔드 세부 분석
| 항목 | 상태 | 비고 |
| --- | --- | --- |
| 라우팅 | ✅ | `AppRouter` + `RequireAuth`. PWA fallback 위해 `vercel.json` rewrites 설정. |
| 상태관리 | ⚠️ | 각 컴포넌트 내 state 사용. 전역 상태(예: user role)에 대한 관리 필요. |
| 카메라/미디어 | ✅ (1차) | 권한 요청, 미리보기 구현. 실제 QR 디코딩 미구현. |
| UI 라이브러리 | ✅ | Radix UI, shadcn 기반. 액세스빌리티 점검 필요. |
| 테스트 | ⚠️ | Playwright smoke test 일부 작성, 로그인/회원가입 플로우 테스트는 아직 도입되지 않음. |
| 빌드/배포 | ✅ | Vercel + `pnpm build`. chunk size 경고 존재(Phase 5). |
| PWA | ❌ | manifest/service worker 미구현. |

### 5. 보안/인증 관련 이슈
- 이메일 인증 링크 초기값이 `http://localhost:3000` → Vercel 도메인으로 업데이트 필수 (완료).
- 이메일 퍼블릭 토큰/환경 변수 노출 이슈가 있었으며 문서에서 플레이스홀더로 교체 완료. 향후 Git hook/Secret scanning 주기적 점검 필요.
- Supabase Anon Key 외에 Service Role key를 프런트에 노출하면 안 되며, 현재 `.env.example`는 안전한 플레이스홀더로 구성.
- QR 스캔, OCR 등 추가 기능 구현 시 사용자 데이터 업로드/보관 정책 수립 필요 (의료 정보 특성).

### 6. UI/UX 관점 개선 포인트
- 복용자/보호자 최초 가입 후 온보딩 플로우(필수 정보 입력, 관계 맺기) 구현 필요.
- 스캔 실패/권한 거부 등 예외 상황 안내 강화. 수기 입력으로도 편하게 진행할 수 있는 UX 제공.
- 다국어 및 접근성(ARIA 속성, 키보드 네비게이션) 체크 필요.
- 오프라인/홈 화면 설치 등 PWA 경험 제공 고려.

### 7. 자동화 및 테스트
- Playwright smoke test: 로그인 페이지 표시만 확인. 회원가입/로그인 플로우, Supabase 연동 테스트 추가 필요.
- Supabase Test 데이터 시드, RLS 검증 자동화 테스트 구축 권장.
- 문서화 업데이트(README, docs/)가 많으나 실시간 유지 관리 필요.

### 8. 다음 단계 제안 (Phase별)
1. **Phase 2 – UX/에러 처리**
   - 스캔 실패 대비 UX, 오류 토스트/가이드 강화.
   - 로그인 후 대시보드/피드 데이터 실노출 준비.
   - 이메일 인증 링크 안내 + 실패 대응 UI(재전송) 추가.
   - 카메라 허용 거부 시 iOS/Android 설정 이동 딥링크 (custom scheme) 검토.

2. **Phase 3 – 기능 확장**
   - QR 디코딩 라이브러리 연동 및 실제 처방전 데이터와 매핑.
   - OCR 도입 여부 결정(서버/클라이언트). 보조 입력 플로우 확립.
   - 보호자-복용자 연결(Supabase) 완성, 실시간 공지/알림 플로우 구축.
   - Supabase RLS/Trigger/Functions 배포 및 자동화.

3. **Phase 4 – 데이터 & 통계**
   - 복용 이력, 통계 대시보드 구현. Supabase Row Level Security 강화.
   - 사용자 역할별 홈/메뉴 최적화.
   - 헬스케어 규제(의료법) 체크 후 개인 정보 처리 방침 마련.

4. **Phase 5 – 테스트 & 성능**
   - Playwright/E2E 테스트 자동화(회원가입, 스캔, 초대 등).
   - 번들 사이즈 최적화 (`manualChunks` 도입).
   - PWA 구현, Lighthouse 퍼포먼스 개선.

5. **Phase 6 – 배포 & 운영**
   - Vercel Production + Preview 브랜치 전략 확립.
   - 에러 모니터링(Sentry 등) / Analytics(Amplitude, GA4) 연동.
   - 고객 지원 프로세스 구축(문의 접수, FAQ).

### 9. 리스크 및 확인 필요 사항
- Figma API 연동 문서에서 실 토큰 노출이 있었으므로 재점검 필요.
- 실제 의료 데이터 다루는 경우, 보안/법적 검토 필요.
- Supabase SMTP 기본값 사용 시 이메일 지연/누락 가능 → 커스텀 SMTP 권장.
- 카메라, 파일 업로드 등 민감 권한 사용 시 개인정보 처리 방침 명시 필요.

### 10. 결론
- 현재 프로젝트는 MVP 수준의 인증/역할 분류/카메라 권한 흐름은 갖추었으나, 스캔/데이터 연동과 보안/테스트 체계는 아직 기획 단계.
- Phase 2~6 로드맵에 따라 QR/OCR 실동작, 보호자-복용자 연동, 자동화 테스트 등 핵심 기능을 순차적으로 완성해야 함.
- 각 단계별 필요한 인력/리소스(모바일 기기 테스트, 의료 데이터 샘플, SMTP 서비스) 확보 권장.


